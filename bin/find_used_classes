#!/usr/bin/env ruby

begin
  raise unless system("middleman build")
rescue
  backup_file = "source/stylesheets/_backup_tachyons.scss"
  File.delete(backup_file) if File.exists?(backup_file)

  puts "build failed continuing"
end

used_classes = Dir.glob("www/**/*")
  .select { |file| file.match(/html$/) }
  .map { |file| puts file; File.read(file).scan(/class="?([\w\s_\-]+)"?/) }
  .flatten
  .join(" ")
  .split(/\s+/).uniq
  .sort
  .join("\n")

File.write("source/stylesheets/used_classes.txt", used_classes + "\n")
